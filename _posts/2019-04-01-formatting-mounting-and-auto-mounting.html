---
layout: post
title: 'Formatting Mounting and Auto mounting '
date: '2019-04-01T09:01:00.002-07:00'
author: "@eamoc"
tags: 
modified_time: '2019-04-01T09:09:37.559-07:00'
blogger_id: tag:blogger.com,1999:blog-6955428370236550107.post-7500225552096642780
blogger_orig_url: https://eamoc.blogspot.com/2019/04/formatting-mounting-and-auto-mounting.html
---

I have a usb drive, that I need to have mounted automatically every time I boot in to Linux.<br />The first thing I do is create mount point, a directory in <b>/mnt</b><br /><div style="text-align: center;"><b>sudo mkdir /mnt/DRV1</b></div><div style="text-align: center;"><br /></div><div style="text-align: left;">I then run <b>lsblk</b>. From the man page:</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><i>lsblk lists information about all available or the specified block<br />devices.&nbsp; The <b>lsblk</b> command reads the sysfs filesystem and udev db to<br />gather information. If the udev db is not available or lsblk is<br />compiled without udev support than it tries to read LABELs, UUIDs and<br />filesystem types from the block device. In this case root permissions<br />are necessary.</i></div><div style="text-align: left;"><i>Running <b>lsblk</b></i> gives me an out put like this:</div><div style="text-align: center;"><br /></div>&nbsp;➜ lsblk<br />NAME&nbsp;&nbsp; MAJ:MIN RM&nbsp;&nbsp; SIZE RO TYPE MOUNTPOINT<br />sda&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:0&nbsp;&nbsp;&nbsp; 0 465.8G&nbsp; 0 disk <br />├─sda1&nbsp;&nbsp; 8:1&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 549M&nbsp; 0 part <br />├─sda2&nbsp;&nbsp; 8:2&nbsp;&nbsp;&nbsp; 0 243.6G&nbsp; 0 part <br />├─sda3&nbsp;&nbsp; 8:3&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 20G&nbsp; 0 part [SWAP]<br />└─sda4&nbsp;&nbsp; 8:4&nbsp;&nbsp;&nbsp; 0 201.6G&nbsp; 0 part /<br />sdb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:16&nbsp;&nbsp; 0&nbsp;&nbsp; 1.8T&nbsp; 0 disk <br />└─sdb1&nbsp;&nbsp; 8:17&nbsp;&nbsp; 0&nbsp;&nbsp; 1.8T&nbsp; 0 part <br />sr0&nbsp;&nbsp;&nbsp;&nbsp; 11:0&nbsp;&nbsp;&nbsp; 1&nbsp; 1024M&nbsp; 0 rom<br /><br />So I can see that my 2Tb drive is listed as sdb. Which means that it lives at /dev/sdb<br /><br />If the drive is new and I need to format it for ext4 for example, I would have to run fdisk, as root<br /><div style="text-align: center;"><b>sudo fdisk /dev/sdb</b></div><div style="text-align: left;"></div><div style="text-align: left;">Then create partitions as required, by following the menu options.</div><div style="text-align: left;">once the partition table is complete, write it do disk.</div><div style="text-align: left;">I have one partition. The information about this can be obtained by the <b>i</b> option in the fdisk menu:</div><div style="text-align: left;"></div><div style="text-align: left;"><br />Command (m for help): i<br />Selected partition 1<br />Device: /dev/sdb1<br />Start: 2048<br />End: 3907029166<br />Sectors: 3907027119<br />Cylinders: 777983<br />Size: 1.8T<br />Id: 83<br />Type: Linux<br />Start-C/H/S: 0/32/33<br />End-C/H/S: 513/80/62</div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"><br />To format the partition, I go:</div><div style="text-align: center;"><b>mkfs.ext4 /dev/sdb1</b></div><div style="text-align: left;"></div><div style="text-align: left;">Now, to mount this drive, I go:</div><div style="text-align: left;"><br /></div><div style="text-align: center;"><b>sudo mount /dev/sdb1 /mnt/DRV1</b><br /><br /><div style="text-align: left;">To make this a permanent arrangement, I need to use the <b>fstab</b> file. The man page describes <b>fstab</b> as:<br /><b></b></div><div style="text-align: left;"><br /></div><div style="text-align: left;">&nbsp; The file fstab contains descriptive information about the filesystems<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the system can mount.&nbsp; fstab is only read by programs, and not written;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; it is the duty of the system administrator to properly create and<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; maintain this file.&nbsp; The order of records in fstab is important because<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fsck(8), mount(8), and umount(8) sequentially iterate through fstab<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doing their thing.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Each filesystem is described on a separate line.&nbsp; Fields on each line<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; are separated by tabs or spaces.&nbsp; Lines starting with '#' are comments.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Blank lines are ignored.<b></b></div><div style="text-align: left;"><b></b></div><div style="text-align: left;"><b></b></div></div><div style="text-align: left;"><br /></div><div style="text-align: left;">The fstab file lives in the /etc directory.</div><div style="text-align: left;"><div class="line867"><br /></div><div class="line867"><tt>/etc/fstab</tt> contains the following fields separated by a space or tab: <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></div><pre><span class="anchor" id="line-1-1"></span>&lt;file system&gt;   &lt;dir&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</pre><pre>&nbsp; </pre></div><div style="text-align: left;"><b>file system</b>, defines the storage device, <b>dir </b>defines the mount point, <b>type </b>defines the pertition type and<b> options</b> define define particular options for filesystems.&nbsp;</div><div style="text-align: left;">Some  options relate only to the filesystem itself. Some of the more common  options are: <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><br /><ul><li><div class="line891"><b>auto</b> - file system will mount automatically at boot, or when the command 'mount -a' is issued. <span class="anchor" id="line-31"></span></div></li><li><div class="line891"><b>noauto</b> - the filesystem is mounted only when you tell it to. <span class="anchor" id="line-32"></span></div></li><li><div class="line891"><b>exec</b> - allow the execution binaries that are on that partition (default). <span class="anchor" id="line-33"></span></div></li><li><div class="line891"><b>noexec</b> - do not allow binaries to be executed on the filesystem. <span class="anchor" id="line-34"></span></div></li><li><div class="line891"><b>ro</b> - mount the filesystem read only. <span class="anchor" id="line-35"></span></div></li><li><div class="line891"><b>rw</b> - mount the filesystem read-write. <span class="anchor" id="line-36"></span></div></li><li><div class="line891"><b>sync</b> - I/O should be done synchronously. <span class="anchor" id="line-37"></span></div></li><li><div class="line891"><b>async</b> - I/O should be done asynchronously. <span class="anchor" id="line-38"></span></div></li><li><div class="line891"><b>flush</b> - specific option for FAT to flush data more often, thus making copy  dialogs or progress bars to stays up until things are on the disk. <span class="anchor" id="line-39"></span></div></li><li><div class="line891"><b>user</b> - permit any user to mount the filesystem (implies noexec,nosuid,nodev unless overridden). <span class="anchor" id="line-40"></span></div></li><li><div class="line891"><b>nouser</b> - only allow root to mount the filesystem (default). <span class="anchor" id="line-41"></span></div></li><li><div class="line891"><b>defaults</b> - default mount settings (equivalent to rw,suid,dev,exec,auto,nouser,async). <span class="anchor" id="line-42"></span></div></li><li><div class="line891"><b>suid</b>  - allow the operation of suid, and sgid bits. They are mostly used to  allow users on a computer system to execute binary executables with  temporarily elevated privileges in order to perform a specific task. <span class="anchor" id="line-43"></span></div></li><li><div class="line891"><b>nosuid</b> - block the operation of suid, and sgid bits. <span class="anchor" id="line-44"></span></div></li><li><div class="line891"><b>noatime</b> - do not update inode access times on the filesystem. Can help performance. <span class="anchor" id="line-45"></span></div></li><li><div class="line891"><b>nodiratime</b> - do not update directory inode access times on the filesystem. Can  help performance. You do not need to enable this flag if you have  already enabled <b>noatime</b>. <span class="anchor" id="line-46"></span></div></li><li><div class="line891"><b>relatime</b> - update inode access times relative to modify or change time. Access  time is only updated if the previous access time was earlier than the  current modify or change time (similar to noatime, but doesn't break  mutt or other applications that need to know if a file has been read  since the last time it was modified). Can help performance.&nbsp;</div><div class="line891"><br /></div><div class="line891" style="text-align: center;"><b>sudo vim /etc/fstab</b></div></li></ul></div><div style="text-align: left;">Finally the last two columns <b>dump</b> and <b>pass </b>define if the drive is to be backed up, and whether or not to check the filesystem.</div><div style="text-align: left;"><b></b><br /></div><div style="text-align: left;">It is also possible to describe the partitions in terms of their UUID. This is what I do.&nbsp; I can find the UUID of my external drive by running <b>blkid.</b></div><div style="text-align: left;"></div><div style="text-align: left;">➜ blkid<br />/dev/sda1: LABEL="System Reserved" UUID="ECC4AF03C4AECEE0" TYPE="ntfs" PARTUUID="078b320e-01"<br />/dev/sda2: UUID="AEDEBE20DEBDE12F" TYPE="ntfs" PARTUUID="078b320e-02"<br />/dev/sda3: UUID="d7331966-1731-4979-911e-314f77c7fffa" TYPE="swap" PARTUUID="078b320e-03"<br />/dev/sda4: UUID="d9ffe28d-e57a-488a-a944-13092fa60cfd" TYPE="ext4" PARTUUID="078b320e-04"<br />/dev/sdb1: UUID="0475ea17-a15b-4b11-91bc-8dea17399e1c" TYPE="ext4" PARTUUID="2ad7c98d-01"</div><div style="text-align: left;"><br /></div><div style="text-align: left;">I include a line in my <b>fstab</b> to include my external USB drive:</div><div style="text-align: left;"></div><br />➜ cat /etc/fstab <br />UUID=d7331966-1731-4979-911e-314f77c7fffa none swap sw 0 0<br />UUID=d9ffe28d-e57a-488a-a944-13092fa60cfd / ext4 defaults 0 1<br />UUID=0475ea17-a15b-4b11-91bc-8dea17399e1c /mnt/DRV1 ext4 defaults 0 2<br />tmpfs /tmp tmpfs defaults,nosuid,nodev 0 0<br /><br /><div style="text-align: left;"></div>